# Руководство для ИИ-агента Gemini

Этот документ содержит инструкции и соглашения для работы с кодовой базой проекта `TelegramWordBot`.

## 1. Обзор проекта

**TelegramWordBot** — это бот для Telegram, написанный на C# и .NET. Его основная цель — помогать пользователям изучать новые слова на разных языках с использованием техники интервального повторения (Spaced Repetition).

**Ключевые возможности:**
- Взаимодействие с пользователями через Telegram.
- Перевод слов, поиск изображений к словам.
- Озвучивание текста (Text-to-Speech) с помощью Gemini и Google TTS.
- Использование ИИ (Gemini) для генерации примеров использования слов.
- Хранение прогресса пользователей в базе данных.
- Многоязычная поддержка интерфейса.

## 2. Технологический стек

- **Язык:** C#
- **Платформа:** .NET
- **Фреймворк:** ASP.NET Core (для Web API) и Worker Service (для фоновой работы бота).
- **База данных:** Используется Dapper для взаимодействия с БД (судя по отсутствию EF Core Migrations и наличию `GuidTypeHandler`).
- **Внешние API:** Telegram Bot API, Gemini API, Google TTS, Pixabay API, Unsplash API.

## 3. Структура проекта

- `TelegramWordBot.sln`: Файл решения, используйте его для сборки и тестирования.
- `Program.cs`: Точка входа приложения, здесь настраивается DI (Dependency Injection) и запускается хост.
- `Worker.cs`: Основной класс, который получает обновления от Telegram и обрабатывает их.
- `Functions.cs`: Содержит основную логику обработки команд и сообщений от пользователя.
- `Controllers/`: Контроллеры ASP.NET Core для возможных веб-хуков или API-эндпоинтов.
- `Models/`: Классы, описывающие сущности данных (User, Word, Translation и т.д.).
- `Repositories/`: Реализация паттерна "Репозиторий" для доступа к данным. **Вся работа с БД должна идти через эти классы.**
- `Services/`: Бизнес-логика, работа с внешними API (Gemini, TTS, поиск изображений).
- `Properties/Resources.resx`: Файл ресурсов по умолчанию (английский).
- `Resources/`: Файлы локализации `.resx` для поддержки разных языков.
- `TelegramWordBot.Tests/`: Каталог с юнит-тестами.

## 4. Рабочий процесс и команды

Всегда выполняйте команды из корневой директории проекта.

- **Сборка проекта:**
  ```bash
  dotnet build TelegramWordBot.sln
  ```
  *Собирает все проекты в решении и проверяет наличие ошибок компиляции.*

- **Запуск приложения (бота):**
  ```bash
  dotnet run --project TelegramWordBot.csproj
  ```
  *Запускает бота. Убедитесь, что все необходимые ключи API указаны в `appsettings.Development.json`.*

- **Запуск тестов:**
  ```bash
  dotnet test TelegramWordBot.sln
  ```
  *Выполняет все юнит-тесты в проекте. Обязательно запускайте эту команду после внесения изменений в логику.*

## 5. Важные соглашения (ОБЯЗАТЕЛЬНО К СОБЛЮДЕНИЮ)

1.  **Локализация:**
    - **НИКОГДА** не используйте строковые литералы (хардкод) для текста, который видит пользователь.
    - **ВСЕГДА** используйте файлы ресурсов. Добавляйте новые строки в `Properties/Resources.Designer.cs` и `Properties/Resources.resx`.
    - Для перевода используйте существующие файлы в `Resources/`, например `SharedResource.ru.resx`.

2.  **Доступ к данным:**
    - **ВСЕГДА** используйте классы из каталога `Repositories/` для любых операций с базой данных.
    - **НЕ** обращайтесь к `Db.cs` напрямую из сервисов, `Functions.cs` или контроллеров.

3.  **Конфигурация:**
    - Ключи API, строки подключения и другие секретные данные должны храниться в `appsettings.Development.json` или переменных окружения. **НЕ** добавляйте их в код.

4.  **Зависимости (DI):**
    - Все сервисы и репозитории должны регистрироваться в `Program.cs` и получаться через конструктор там, где они необходимы. Не создавайте экземпляры вручную.

5.  **Стиль кода:**
    - Придерживайтесь существующего стиля форматирования, именования и структуры кода.
